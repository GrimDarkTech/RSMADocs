# Настройка механического дифференциала
[Switch to English](Manual/en/Mechanics/Setting_up_mechanical_differential.md)

RSMA использует модуль **Differential** для моделирования механических дифференциалов.

## Требования
- модель механической дифференциала с настроенной физикой твердого тела
- модель тела, соединенного с правым валом дифференциала, с настроенной физикой твердого тела
- модель тела, соединенного с левым валом дифференциала, с настроенной физикой твердого тела
- известное значение передаточных чисел дифференциала

## Настройка дифференциала на примере симметричного дифференциала мобильной платформы
Далее описаны шаги, необходимые для сборки устройства и присоединения к нему твердых тел
## Подготовка объектов

Поместите объекты на сцену Unity (рис. 1).\
![](/Manual/_images/Setting_up_mechanical_differential/Objects.png)\
Рисунок 1 – Настраиваемые объекты

В окне "Hierarchy" выберите присоединяемые объекты и отрегулируйте их вращение и положение с импользованием [инструментов Unity](https://docs.unity3d.com/Manual/PositioningGameObjects.html).
В рассматриваемом примере, колеса совмещены с выходными валами дифференциала (рис. 2).\
![](/Manual/_images/Setting_up_mechanical_differential/Placed.png)\
Рисунок 2 – Колеса совмещены с механизмом

## Настройка компонента Differential

В окне "Hierarchy" выберите объект дифференциала (рис. 3).\
![](/Manual/_images/Setting_up_mechanical_differential/Selected.png)\
Рисунок 3 – Выбран дифференциал

В окне "Inspector" используйте кнопку "Add Component" для поиска и добавления компонента Differential (рис. 4).\
![](/Manual/_images/Setting_up_mechanical_differential/AddComponent.png)\
Рисунок 4 – Добавление компонента Differential в окне "Inspector"

Если Differential был успешно добавлен, он отобразится в окне инспектора (рис. 5).\
![](/Manual/_images/Setting_up_mechanical_differential/Component.png)\
Рисунок 5 –  Компонент Differential в окне "Inspector"

Меню компонента Gearbox содержит следующие поля, используте их для настройки параметров передачи:
| Поле | Описание | Тип | Значение|
|--|--|--|--|
|rightGearRatio|Передаточное число передачи правого вывода дифференциала|System.Single|от ±1,5 x 10e−45 до ±3,4 x 10e38|
|leftGearRatio|Передаточное число передачи левого вывода дифференциала|System.Single|от ±1,5 x 10e−45 до ±3,4 x 10e38|
|rightConnectedBody|Твердое тело соединенное с правым выходным валом дифференциала|UnityEngine.Rigidbody|Ссылка|
|rightAxis|Ось вращения правого вала дифференциала, заданая в локальной системе координат объекта|UnityEngine.Vector3|Вектор единичной длины|
|isResetRightAnchor|Если значение равно True, то выполняется сброс привязки правой оси вращения в соответствии с полями anchor и connectedAnchor|System.Boolean|True/False|
|rightAnchor|Координаты правой точки привязки в локальной системе координат объекта. Определяет точку, через которую проходит правая ось вращения выходного вала|UnityEngine.Vector3|от ±1,5 x 10e−45 до ±3,4 x 10e38|
|rightConnectedAnchor|Координаты точки привязки в локальной системе координат присоединяемого к правому выводу тела. Определяет точку, через которую проходит правая ось вращения|UnityEngine.Vector3|от ±1,5 x 10e−45 до ±3,4 x 10e38|
|leftConnectedBody|Твердое тело соединенное с левым выходным валом дифференциала|UnityEngine.Rigidbody|Ссылка|
|leftAxis|Ось вращения левого вала дифференциала, заданая в локальной системе координат объекта|UnityEngine.Vector3|Вектор единичной длины|
|isResetLeftAnchor|Если значение равно True, то выполняется сброс привязки левой оси вращения в соответствии с полями anchor и connectedAnchor|System.Boolean|True/False|
|leftAnchor|Координаты левой точки привязки в локальной системе координат объекта. Определяет точку, через которую проходит левая ось вращения выходного вала|UnityEngine.Vector3|от ±1,5 x 10e−45 до ±3,4 x 10e38|
|leftConnectedAnchor|Координаты точки привязки в локальной системе координат присоединяемого к левому выводу тела. Определяет точку, через которую проходит левая ось вращения|UnityEngine.Vector3|от ±1,5 x 10e−45 до ±3,4 x 10e38|
|brakingFactor|Коэффициент торможения. Характеризует сопротивление вращению выходных валов|System.Single|от ±1,5 x 10e−45 до ±3,4 x 10e38|
|maxAngularVelocity|Максимальное значение угловой скорости для присоединенного тела в радианах в секунду|System.Single|от ±1,5 x 10e−45 до ±3,4 x 10e38|
|isDrawAnchors|Если значение равно True, положение точек привязок отображается сферами, а ось - линиями|System.Boolean|True/False|
|outputTorque|Величина крутящего момента выходного вала. Расчитывается автоматически|UnityEngine.Vector3|Заполняется автоматически|

В полях rightGearRatio и leftGearRatio укажите значение передаточных чисел выводов дифференциала.
Если дифференциал симметричный, установите одинаковые значения передаточных чисел.
Если передача работает в режиме редуктора, как в рассматриваемом примере (рис. 6), модуль передаточного числа должен быть больше 1. Ввод отрицательного числа изменит направление вращения выходного вала.
Если передача работает в режиме мультипликатора, модуль передаточного числа меньше 1.
Если передача не изменяет величину крутящего момента, модуль передаточного числа - 1.\
![](/Manual/_images/Setting_up_mechanical_differential/Ratio.png)\
Рисунок 6 –  Значение полей rightGearRatio и leftGearRatio

Алгоритм настройки правого и левово вывода дифференциала одинаковый, далее рассмотрена конфигурация только правого вывода.

Для заполнения поля rightConnectedBody окне "Hierarchy" найдите правый присоединяемый объект, наведите на него курсор, зажмите левую кнопку мыши и перенесите его в поле.
В рассматриваемом примере, выбран объект колеса и помещен в соответсвующие поле (рис. 7).\
![](/Manual/_images/Setting_up_mechanical_differential/ConnectedBody.png)\
Рисунок 7 – Ссылка на объект колеса

Аналогичным образом укажите leftConnectedBody, задав левый присоединяемый объект.

Чтобы заполнить поле RightAxis необходимо определить направление оси вращения правого вывода в локальной системе координат объекта.

Убедитесь, что инструмент перемещения объектов переключен на режим работы в локальных координатах, как показано на рисунке 8.\
![](/Manual/_images/Setting_up_hinge_joints/ToolSettings.png)\
Рисунок 8 – Настройки инструмента позиционирования объектов

В окне "Hierarchy" выберите объект диффиренциала. Выбранный объект выделится в окне "Scene". На выделенном объекте появится инструмент позиционирования (рис. 9).\
![](/Manual/_images/Setting_up_mechanical_differential/Axis.png)\
Рисунок 9 – Инструмент позиционирования

Направления стрелок инструмента соотвествуют ориентации локальной системы координат объекта, где:
- синяя стрелка - ось Z (вперед);
- красная стрелка - ось X (вправо);
- зеленая стрелка - ось Y (вверх).

В рассматриваемом примере, ось вращения выходного вала направлена паралельно красной стрекле, что соотвествует оси X.
Значение поля RightAxis - (1, 0, 0) - вектор единичной длины, сонаправленный с осью X (рис. 10).\
![](/Manual/_images/Setting_up_mechanical_differential/AxisValue.png)\
Рисунок 10 – Значение поля RightAxis

Unity может выполнить автоматическую настройку точек привязки при создании соединения, что очень удобно для пользователя. Однако это может привести к несоосности или прогибу соединения.
Для отключения автоматической настройки точек привязкип правого вала поставьте галочку в поле isResetRightAnchor.
Настройка точек привзяки производится с использованием полей rightAnchor и rightConnectedAnchor.

Включите отображение точек привязки, поставив галочку в поле isDrawAnchors. Точки прявзки будут отрисованы в окне "Scene", красная сфера - точка привязки объекта дифференциала, зеленая - присоединяемого тела. На рисунке 11 показаны точки привязки для дифференциала и колес.\
![](/Manual/_images/Setting_up_mechanical_differential/Anchors.png)\
Рисунок 11 – Отображение точек привязки

Изменяя значение поля RightAnchor переместите красную сферу в точку, в которой будет расположена ось вращения правого вала (рис. 12).\
![](/Manual/_images/Setting_up_mechanical_differential/Anchor1.png)\
Рисунок 12 – Точка привязки правого вывода

Изменяя значение поля RightConnectedAnchor переместите зеленую сферу в точку, через которую будет проходить ось вращения (рис. 13). Если объекты изначально совмещены, как в рассматриваемом примере, сферы должны совпасть. Если объекты не были совмещены, после запуска моделирования произойдет автоматическое совмещение\
![](/Manual/_images/Setting_up_mechanical_differential/Anchor2.png)\
Рисунок 13 – Точка привязки правого колеса

В рассматриваемом примере, заданы следующие точки привзяки правого вывода(рис. 14):\
![](/Manual/_images/Setting_up_mechanical_differential/Setted.png)\
Рисунок 14 – Настроенные точки привязки

После завершения настройки правого вала, аналогичным образом настройкте левый вал.
Затем отключите отображение сфер, сняв галочку в поле isDrawAnchors.

Поле BrakingFactor определяет величину момента сопротивления вращению выходного вала. Момент линейно зависит от скорости вращения.
Рекомендуемое значение - 0.01 (рис. 15). Изменяйте, в случае, если необходимо создать дифференциал повышеного трения или отключить трение.\
![](/Manual/_images/Setting_up_mechanical_gears/BreakingFactor.png)\
Рисунок 15 – Значение поля BrakingFactor

Если вы ожидаете скорость вращения выходного вала передачи выше, чем 523 радиана в секунду. Измените это значение в поле maxAngularVelocity.
Значение по умолчанию - 523.

## Задания

С целью получения опыта настройки жестких механических дифференциалов и улучшения навыков работы с компонентом Differential, настройте:
- симметричный дифференциал повышенного трения;
- несимметричный дифференциал с распределением крутящего момента 80/20.
