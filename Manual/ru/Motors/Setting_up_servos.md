# Настройка сервопривода
[Switch to English](Manual/en/Motors/Setting_up_servos.md)

RSMA использует модуль **RSMAServo** для моделирования работы сервоприводов.

## Требования
- модель сервопривода с настроенной физикой твердого тела
- модель тела, соединенного с валом двигателя (механическая передача, дифференциал, рабочий орган) с настроенными имитационными модулями
- настроенный микроконтроллер, к которому подлкючен сервопривод

## Настройка имитационной модели сервопривода на примере SM-S4315R
Далее описаны шаги, необходимые для создания и настройки сервопривода
## Подготовка объектов

Поместите объекты привода и присоединяемого к его валу тела на сцену Unity (рис. 1).\
![](/Manual/_images/Setting_up_servos/Objects.png)\
Рисунок 1 – Настраиваемые объекты

В окне "Hierarchy" выберите присоединяемый объект и отрегулируйте его вращение и положение с импользованием [инструментов Unity](https://docs.unity3d.com/Manual/PositioningGameObjects.html).
В рассматриваемом примере, рычаг совмещен с валом сервопривода (рис. 2).\
![](/Manual/_images/Setting_up_servos/Placed.png)\
Рисунок 2 – Рычаг совмещен с валом привода

## Настройка компонента RSMAServo

В окне "Hierarchy" выберите объект сервопривода (рис. 3).\
![](/Manual/_images/Setting_up_servos/Selected.png)\
Рисунок 3 – Выбран привод S4315R

В окне "Inspector" используйте кнопку "Add Component" для поиска и добавления компонента RSMAServo (рис. 4).\
![](/Manual/_images/Setting_up_servos/AddComponent.png)\
Рисунок 4 – Добавление компонента RSMAServo в окне "Inspector"

Если RSMAServo был успешно добавлен, он отобразится в окне инспектора (рис. 5).\
![](/Manual/_images/Setting_up_servos/Component.png)\
Рисунок 5 –  Компоненты RSMAServo в окне "Inspector"

Меню компонента RSMAMotor2 содержит следующие поля, используте их для настройки:
| Поле | Описание | Тип | Значение|
|--|--|--|--|
|connectedBody|Твердое тело, соединенное с валом привода|UnityEngine.Rigidbody|Ссылка|
|Axis|Ось вращения вала привода, заданая в его локальной системе координат|UnityEngine.Vector3|Вектор единичной длины|
|microcontroller|Микроконтроллер, к которому подключен привод|RSMAGPIO|Ссылка|
|connectedPin|Вывод порта GPIO микроконтроллера, к которому подключен привод|ConnectedPin|Структура|
|isUseLimits|Если значение True, то сервопривод имеет ограничения по углам поворота|System.Boolean|True/False|
|limits|Углы, ограничивающие вращение вала сервопривода|UnityEngine.Vector2|от ±1,5 x 10e−45 до ±3,4 x 10e38|
|torque|Величина крутящего момента, развиваемого приводом|System.Single|от ±1,5 x 10e−45 до ±3,4 x 10e38|
|damper|Коэффициент торможения. Характеризует сопротивление вращению вала| System.Single| от ±1,5 x 10e−45 до ±3,4 x 10e38|
|isResetAnchor|Если значение равно True, то выполняется сброс привязки оси вращения вала в соответствии с полями motorAnchor и connectedAnchor|System.Boolean|True/False|
|Anchor|Координаты точки привязки в локальной системе координат двигателя. Определяет точку, через которую проходит ось вращения вала|UnityEngine.Vector3|от ±1,5 x 10e−45 до ±3,4 x 10e38|
|connectedAnchor|Координаты точки привязки в локальной системе координат присоединяемого тела. Определяет точку, через которую проходит ось вращения вала|UnityEngine.Vector3|от ±1,5 x 10e−45 до ±3,4 x 10e38|
|isDrawAnchors|Если значение равно True, положение точек привязок отображается сферами, а ось - линиями|System.Boolean|True/False|

### Заполнение поля ConnectedBody
Для заполнения поля connectedBody окне "Hierarchy" найдите присоединяемый объект, наведите на него курсор, зажмите левую кнопку мыши и перенесите его в поле.

В рассматриваемом примере, объект рачага выбран и помещен в поле (рис. 6).\
![](/Manual/_images/Setting_up_servos/ConnectedBody.png)\
Рисунок 6 – Ссылка на объект рычага

### Заполнение поля Axis
Для заполнения поля axis необходимо определить направление оси вращения вала в локальной системе координат двигателя.

Убедитесь, что инструмент перемещения объектов переключен на режим работы в локальных координатах, как показано на рисунке 7.\
![](/Manual/_images/Setting_up_hinge_joints/ToolSettings.png)\
Рисунок 7 – Настройки инструмента позиционирования объектов

В окне "Hierarchy" выберите объект двигателя. Выбранный объект выделится в окне "Scene". На выделенном объекте появится инструмент позиционирования (рис. 8).\
![](/Manual/_images/Setting_up_servos/Axis.png)\
Рисунок 8 – Инструмент позиционирования на выбранном объекте

Направления стрелок инструмента соотвествуют ориентации локальной системы координат объекта, где:
- синяя стрелка - ось Z (вперед);
- красная стрелка - ось X (вправо);
- зеленая стрелка - ось Y (вверх).

В рассматриваемом примере, ось вращения вала сонаправлена с синей стрелкой, что соотвествует оси Z.
Значение поля Axis - (0, 0, 1) - вектор единичной длины, сонаправленный с осью Z (рис. 9).\
![](/Manual/_images/Setting_up_servos/AxisValue.png)\
Рисунок 9 – Значение поля motorAxis

### Подключение к микроконтроллеру

Для подключения привода к выводам порта GPIO микроконтроллера используйте поля:
- Microcontroller - микроконтроллер, к которому подключен сервопривод;
- ConnectedPin - вывод порта GPIO микроконтроллера, к которому подключен привод;

Для заполнения поля ConnectMicrocontroller в окне "Hierarchy" наведите курсор на микроконтроллер, к которому будет подключен драйвер, зажмите левую кнопку мыши и перенесите его в поле ConnectMicrocontroller.

Разверните список параметров поля ConnectedPin, в поле PortName укажите имя порта GPIO, к которому подключен привод, в поле PinName - имя вывода порта GPIO, к которому подключен привод.

В рассматриваемом примере, привод подключен к STM32F103C8. Первый канал подключен к выводу 1 порта PA (рис. 10).\
![](/Manual/_images/Setting_up_servos/Microcontroller.png)\
Рисунок 10 – Значение полей для подключения микроконтроллера

### Настройка параметров вращения вала

Если настраиваемое устройство, имеет ограничения по углу поворота вала, активируйте ограничение, установив галочку в поле isUseLimits.

В поле Limits задайте крайние положения вала двигателя в градусах. Для модели, рассматриваемой в примере, доступен поворот в диапазоне от 0 до 360 градусов (рис. 11).\
![](/Manual/_images/Setting_up_servos/Limits.png)\
Рисунок 11 – Настройки ограничений вращения вала

Используйте поле Torque, чтобы задать крутящий момент, развиваемый двигателем. Для модели SM-S4315R, момент - 1.42 нм (рис. 12).\
![](/Manual/_images/Setting_up_servos/Torque.png)\
Рисунок 12 – Значение поля Torque

Поле Damper определяет величину момента сопротивления вращению вала двигателя. Момент линейно зависит от скорости вращения.
Рекомендуемое значение - 0.05. Изменяйте, в случае, если необходимо создать самотормозящийся привод или уменьшить сопротивление вращению.

### Настройка точек привязки

Для отключения автоматической настройки точек привязки поставьте галочку в поле isResetAnchor.
Настройка точек привзяки производится с использованием полей Anchor и ConnectedAnchor.

Включите отображение точек привязки, поставив галочку в поле isDrawAnchors. Точки прявзки будут отрисованы в окне "Scene", красная сфера - точка привязки двигателя, зеленая - присоединяемого тела. На рисунке 13 показаны точки электродвигателя и рычага.\
![](/Manual/_images/Setting_up_servos/Anchors.png)\
Рисунок 13 – Отображение точек привязки двигателя и рычага

Изменяя значение поля Anchor переместите красную сферу в точку, в которой будет расположена ось вращения.
Изменяя значение поля ConnectedAnchor переместите зеленую сферу в точку, через которую будет проходить ось вращения.

После запуска моделирования соединение будет настроено так, что зеленая сфера совпадет с красной (рис. 14).\
![](/Manual/_images/Setting_up_servos/Anchors2.png)\
Рисунок 14 – Соединение после запуска моделирования

В рассматриваемом примере, заданы следующие настройки привзяки (рис. 15):\
![](/Manual/_images/Setting_up_servos/Setted.png)\
Рисунок 15 – Настройки привязки 

После завершения настройки отключите отображение сфер, сняв галочку в поле isDrawAnchors.

## Задания

С целью получения опыта настройки сервоприводов и улучшения навыков работы с компонентом RSMAServo, настройте:
- манипулятор из сервоприводов;
- сервопривод FY-S3 SB1513;
- сервопривод M0200 20G.
- сервопривод FY-DJ01.
